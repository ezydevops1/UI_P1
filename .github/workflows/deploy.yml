name: CD
on:
  push:
    branches: [dev, qa, prod]
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment'
        required: true
        default: 'dev'
        type: choice
        options:
          - dev
          - qa
          - prod

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Determine environment
        id: env
        run: |
          if [[ "${{ github.ref }}" == "refs/heads/dev" ]] || [[ "${{ github.event.inputs.environment }}" == "dev" ]]; then
            echo "DEPLOY_ENV=dev" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref }}" == "refs/heads/qa" ]] || [[ "${{ github.event.inputs.environment }}" == "qa" ]]; then
            echo "DEPLOY_ENV=qa" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref }}" == "refs/heads/prod" ]] || [[ "${{ github.event.inputs.environment }}" == "prod" ]]; then
            echo "DEPLOY_ENV=prod" >> $GITHUB_OUTPUT
          else
            echo "DEPLOY_ENV=dev" >> $GITHUB_OUTPUT
          fi
          
      - name: Deploy application
        run: |
          echo "ğŸš€ Starting deployment to ${{ steps.env.outputs.DEPLOY_ENV }} environment"
          echo "ğŸ“¦ Preparing deployment package..."
          sleep 2
          echo "âš¡ Deploying application..."
          sleep 2
          echo "âœ… Successfully deployed to ${{ steps.env.outputs.DEPLOY_ENV }} environment"
          echo "ğŸŒ Application URL: https://${{ steps.env.outputs.DEPLOY_ENV }}.ezyportal.com"
