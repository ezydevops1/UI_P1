name: CD Pipeline

on:
  push:
    branches: [ dev, qa, prod ]
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment'
        required: true
        default: 'dev'
        type: choice
        options:
          - dev
          - qa  
          - prod

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Determine Environment
        id: env
        run: |
          if [[ "${{ github.ref }}" == "refs/heads/dev" ]] || [[ "${{ github.event.inputs.environment }}" == "dev" ]]; then
            echo "environment=dev" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref }}" == "refs/heads/qa" ]] || [[ "${{ github.event.inputs.environment }}" == "qa" ]]; then
            echo "environment=qa" >> $GITHUB_OUTPUT
          elif [[ "${{ github.ref }}" == "refs/heads/prod" ]] || [[ "${{ github.event.inputs.environment }}" == "prod" ]]; then
            echo "environment=prod" >> $GITHUB_OUTPUT
          else
            echo "environment=dev" >> $GITHUB_OUTPUT
          fi
        
      - name: Deploy Application
        run: |
          TARGET_ENV="${{ steps.env.outputs.environment }}"
          echo "ğŸš€ Starting deployment to $TARGET_ENV environment"
          echo "ğŸ“¦ Preparing deployment package..."
          echo "ğŸ”§ Configuring $TARGET_ENV settings..."
          echo "âš¡ Deploying application..."
          sleep 3
          echo "âœ… Successfully deployed to $TARGET_ENV environment"
          echo "ğŸŒ Application URL: https://$TARGET_ENV.example.com"
          echo "ğŸ“… Deployment completed at: $(date)"
