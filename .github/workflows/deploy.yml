name: CD
on:
  push:
    branches: [dev, qa, prod]
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment'
        required: true
        default: 'dev'
        type: choice
        options:
          - dev
          - qa
          - prod

jobs:
  deploy-dev:
    if: github.ref == 'refs/heads/dev' || (github.event_name == 'workflow_dispatch' && github.event.inputs.environment == 'dev')
    runs-on: ubuntu-latest
    environment: dev
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Deploy to DEV
        env:
          DB_CONN: ${{ secrets.DB_CONN }}
          API_KEY: ${{ secrets.API_KEY }}
          AZURE_CREDENTIALS: ${{ secrets.AZURE_CREDENTIALS }}
        run: |
          echo "ðŸš€ Deploying to DEV environment"
          echo "Database: ${DB_CONN:0:20}..."
          echo "âœ… DEV deployment completed"

  deploy-qa:
    if: github.ref == 'refs/heads/qa' || (github.event_name == 'workflow_dispatch' && github.event.inputs.environment == 'qa')
    runs-on: ubuntu-latest
    environment: qa
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Deploy to QA
        env:
          DB_CONN: ${{ secrets.DB_CONN }}
          API_KEY: ${{ secrets.API_KEY }}
          AZURE_CREDENTIALS: ${{ secrets.AZURE_CREDENTIALS }}
        run: |
          echo "ðŸš€ Deploying to QA environment"
          echo "Database: ${DB_CONN:0:20}..."
          echo "âœ… QA deployment completed"

  deploy-prod:
    if: github.ref == 'refs/heads/prod' || (github.event_name == 'workflow_dispatch' && github.event.inputs.environment == 'prod')
    runs-on: ubuntu-latest
    environment: prod
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Deploy to PROD
        env:
          DB_CONN: ${{ secrets.DB_CONN }}
          API_KEY: ${{ secrets.API_KEY }}
          AZURE_CREDENTIALS: ${{ secrets.AZURE_CREDENTIALS }}
        run: |
          echo "ðŸš€ Deploying to PROD environment"
          echo "Database: ${DB_CONN:0:20}..."
          echo "âœ… PROD deployment completed"
